# ===================================================================
# CONFIGURACIÓN DE APACHE PARA LARAVEL EN SUBDIRECTORIO
# Proyecto: Sistema de Inventario Monkits
# Subdirectorio: /inventario/
# ===================================================================

# Opción 1: Usando Alias (RECOMENDADO)
# ===================================================================
# Agregar esto dentro del VirtualHost de monkits.com
# Ubicación: /etc/apache2/sites-available/monkits.com.conf
#            o /etc/httpd/conf.d/monkits.com.conf

<VirtualHost *:80>
    ServerName monkits.com
    ServerAlias www.monkits.com

    # Documento raíz del sitio principal
    DocumentRoot /var/www/monkits.com

    # Configuración del sitio principal
    <Directory /var/www/monkits.com>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>

    # ============================================================
    # ALIAS PARA EL INVENTARIO (Cambiar la ruta según tu servidor)
    # ============================================================
    Alias /inventario /ruta/completa/a/inventario-8/public

    <Directory /ruta/completa/a/inventario-8/public>
        Options -Indexes +FollowSymLinks

        # ¡MUY IMPORTANTE! Permitir .htaccess
        AllowOverride All

        # Permitir acceso
        Require all granted

        # Habilitar mod_rewrite
        <IfModule mod_rewrite.c>
            RewriteEngine On
        </IfModule>

        # Configuración para archivos PHP
        <FilesMatch \.php$>
            SetHandler application/x-httpd-php
        </FilesMatch>
    </Directory>

    # Logs
    ErrorLog ${APACHE_LOG_DIR}/monkits_error.log
    CustomLog ${APACHE_LOG_DIR}/monkits_access.log combined
</VirtualHost>

# ===================================================================
# CONFIGURACIÓN HTTPS (SSL) - Si usas certificado
# ===================================================================

<VirtualHost *:443>
    ServerName monkits.com
    ServerAlias www.monkits.com

    DocumentRoot /var/www/monkits.com

    # Certificados SSL
    SSLEngine on
    SSLCertificateFile /etc/ssl/certs/monkits.com.crt
    SSLCertificateKeyFile /etc/ssl/private/monkits.com.key
    # SSLCertificateChainFile /etc/ssl/certs/monkits.com.ca-bundle

    # Configuración del sitio principal
    <Directory /var/www/monkits.com>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>

    # ALIAS PARA EL INVENTARIO
    Alias /inventario /ruta/completa/a/inventario-8/public

    <Directory /ruta/completa/a/inventario-8/public>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted

        <IfModule mod_rewrite.c>
            RewriteEngine On
        </IfModule>

        <FilesMatch \.php$>
            SetHandler application/x-httpd-php
        </FilesMatch>
    </Directory>

    ErrorLog ${APACHE_LOG_DIR}/monkits_ssl_error.log
    CustomLog ${APACHE_LOG_DIR}/monkits_ssl_access.log combined
</VirtualHost>

# ===================================================================
# INSTRUCCIONES DE INSTALACIÓN
# ===================================================================

# 1. REEMPLAZAR LA RUTA:
#    Cambiar: /ruta/completa/a/inventario-8/public
#    Por ejemplo: /home/usuario/public_html/inventario-8/public
#                 o /var/www/inventario-8/public

# 2. HABILITAR mod_rewrite:
#    sudo a2enmod rewrite
#    sudo a2enmod ssl  (si usas HTTPS)

# 3. GUARDAR ESTE ARCHIVO:
#    sudo nano /etc/apache2/sites-available/monkits.com.conf

# 4. HABILITAR EL SITIO:
#    sudo a2ensite monkits.com.conf

# 5. VERIFICAR LA CONFIGURACIÓN:
#    sudo apache2ctl configtest

# 6. REINICIAR APACHE:
#    sudo systemctl restart apache2
#    # O en CentOS/RHEL:
#    sudo systemctl restart httpd

# 7. PERMISOS:
#    cd /ruta/completa/a/inventario-8
#    sudo chown -R www-data:www-data storage bootstrap/cache
#    sudo chmod -R 775 storage bootstrap/cache

# 8. VERIFICAR:
#    - Acceder a: https://monkits.com/inventario/test-server.php
#    - Debe mostrar el diagnóstico completo
#    - Luego eliminar el archivo test-server.php por seguridad

# ===================================================================
# TROUBLESHOOTING
# ===================================================================

# PROBLEMA: 404 Not Found
# SOLUCIÓN: Verificar que AllowOverride esté en "All"

# PROBLEMA: 500 Internal Server Error
# SOLUCIÓN: Ver logs con: sudo tail -f /var/log/apache2/monkits_error.log

# PROBLEMA: "Ruta no encontrada" de Laravel
# SOLUCIÓN: Verificar que .htaccess exista y tenga RewriteBase /inventario/

# PROBLEMA: Assets no cargan (CSS/JS)
# SOLUCIÓN: Compilar con: npm run build
#           Verificar APP_URL en .env
